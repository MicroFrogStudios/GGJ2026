[gd_scene format=3 uid="uid://s6jgpvyxe42i"]

[ext_resource type="Script" uid="uid://dvmkjcuu4vlvu" path="res://scripts/multimaskedtilemap.gd" id="1_ljsc8"]
[ext_resource type="Script" uid="uid://cqfbx47wt6d28" path="res://scripts/masked_layer.gd" id="3_nendb"]
[ext_resource type="Script" uid="uid://b7qtr6cokots2" path="res://scripts/death_spotlight.gd" id="4_nendb"]
[ext_resource type="PackedScene" uid="uid://br8vdgnj8vei8" path="res://scenes/prefabs/exitdoor.tscn" id="4_nyalh"]
[ext_resource type="PackedScene" uid="uid://4aghjpy7mbvk" path="res://scenes/game_ui.tscn" id="4_oscf3"]
[ext_resource type="PackedScene" uid="uid://bblb7m455o2uf" path="res://scenes/prefabs/character_mask.tscn" id="5_fle77"]
[ext_resource type="PackedScene" uid="uid://dm6qoe57l87ub" path="res://scenes/prefabs/player.tscn" id="5_oscf3"]
[ext_resource type="Texture2D" uid="uid://ds1qav1ujcvw5" path="res://assets/sprites/stars.png" id="6_8g1bm"]
[ext_resource type="PackedScene" uid="uid://v0bxw5r7bav0" path="res://scenes/prefabs/CameraFollow.tscn" id="6_fle77"]
[ext_resource type="Shader" uid="uid://g2kx26x1mj7r" path="res://shaders/spotlight.gdshader" id="8_5a7mx"]
[ext_resource type="Shader" uid="uid://bjwbh1c5jyjcy" path="res://shaders/shockwave.gdshader" id="9_nyalh"]
[ext_resource type="TileSet" uid="uid://d2courmo8ldu5" path="res://resources/tilesets/CarlosTileset.tres" id="10_nyalh"]
[ext_resource type="Script" uid="uid://cc4bjxe2aebir" path="res://scripts/ripple_layer.gd" id="11_oscf3"]
[ext_resource type="Shader" uid="uid://fv4s56mmwbu0" path="res://shaders/background.gdshader" id="14_blw4j"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_t3n0d"]
shader = ExtResource("14_blw4j")
shader_parameter/pattern = ExtResource("6_8g1bm")
shader_parameter/size = 1.0
shader_parameter/direction = Vector2(-1, -1)
shader_parameter/speed = 0.02

[sub_resource type="Animation" id="Animation_xornt"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:material:shader_parameter/radius")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [2.0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../../RippleLayer/Ripple:material:shader_parameter/radius")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [-0.1]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("../../RippleLayer:visible")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_fle77"]
resource_name = "mask_ripple"
length = 0.46666667
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../../RippleLayer/Ripple:material:shader_parameter/radius")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.4666667),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [-0.1, 2.0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../../RippleLayer:visible")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.46666667),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [true, false]
}

[sub_resource type="Animation" id="Animation_ggudt"]
resource_name = "spotlight"
length = 1.1666666
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:material:shader_parameter/radius")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.93333334, 1.2, 1.5333333),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [2.0, -0.1, -0.1, 2.0]
}
tracks/1/type = "method"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../../../PlayerCharacter")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(1.1666666),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"spawn"
}]
}

[sub_resource type="Animation" id="Animation_nendb"]
resource_name = "spotlight_exit"
length = 2.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:material:shader_parameter/radius")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1.8),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [2.0, -0.1]
}
tracks/1/type = "method"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../../../ExitDoor")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(1.9666667),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"go_to_next_level"
}]
}

[sub_resource type="Animation" id="Animation_12kvg"]
resource_name = "spotlight_spawn"
length = 0.33333334
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:material:shader_parameter/radius")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.33333325),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [-0.1, 2.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_nendb"]
_data = {
&"RESET": SubResource("Animation_xornt"),
&"mask_ripple": SubResource("Animation_fle77"),
&"spotlight_death": SubResource("Animation_ggudt"),
&"spotlight_exit": SubResource("Animation_nendb"),
&"spotlight_spawn": SubResource("Animation_12kvg")
}

[sub_resource type="ShaderMaterial" id="ShaderMaterial_5a7mx"]
shader = ExtResource("8_5a7mx")
shader_parameter/center = Vector2(0.5, 0.5)
shader_parameter/radius = 2.0

[sub_resource type="ShaderMaterial" id="ShaderMaterial_oscf3"]
shader = ExtResource("9_nyalh")
shader_parameter/center = Vector2(0.5, 0.5)
shader_parameter/force = 0.05
shader_parameter/radius = -0.1
shader_parameter/atenuation_factor = 0.0

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_6v23s"]
distance = -192.0

[node name="LevelBoilerplate2" type="Node2D" unique_id=1082980837]

[node name="PlayerCharacter" parent="." unique_id=614979792 instance=ExtResource("5_oscf3")]
unique_name_in_owner = true
position = Vector2(-223, -112)
slide_on_ceiling = false

[node name="CharacterMask" parent="." unique_id=2087027964 node_paths=PackedStringArray("player") instance=ExtResource("5_fle77")]
position = Vector2(-238, 13)
player = NodePath("../PlayerCharacter")

[node name="ExitDoor" parent="." unique_id=45997899 instance=ExtResource("4_nyalh")]
z_index = -1
position = Vector2(-129, -94)

[node name="CameraFollow" parent="." unique_id=467601528 node_paths=PackedStringArray("following") instance=ExtResource("6_fle77")]
limit_left = -284
limit_bottom = 0
limit_smoothed = true
drag_left_margin = 0.1
drag_top_margin = 0.1
drag_right_margin = 0.1
drag_bottom_margin = 0.1
editor_draw_limits = true
following = NodePath("../PlayerCharacter")
follow_speed = 10

[node name="CanvasLayer" type="CanvasLayer" parent="CameraFollow" unique_id=910592158]
layer = -5

[node name="ColorRect" type="ColorRect" parent="CameraFollow/CanvasLayer" unique_id=743532276]
z_index = -100
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0.7372549, 0.6784314, 0.8039216, 1)

[node name="BackgroundStars" type="ColorRect" parent="CameraFollow" unique_id=1804315535]
z_index = -5
material = SubResource("ShaderMaterial_t3n0d")
offset_left = -684.0
offset_top = -538.0
offset_right = 867.0
offset_bottom = 228.0

[node name="EffectsAnimator" type="AnimationPlayer" parent="CameraFollow" unique_id=1816478192]
unique_name_in_owner = true
root_node = NodePath("../SpotlightLayer/DeathSpotlight")
libraries/ = SubResource("AnimationLibrary_nendb")

[node name="SpotlightLayer" type="CanvasLayer" parent="CameraFollow" unique_id=1087320890]

[node name="GameUi" parent="CameraFollow/SpotlightLayer" unique_id=1129233128 node_paths=PackedStringArray("player_character") instance=ExtResource("4_oscf3")]
player_character = NodePath("../../../PlayerCharacter")

[node name="DeathSpotlight" type="ColorRect" parent="CameraFollow/SpotlightLayer" unique_id=1096391294]
material = SubResource("ShaderMaterial_5a7mx")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("4_nendb")

[node name="RippleLayer" type="CanvasLayer" parent="CameraFollow" unique_id=1810096008]

[node name="Ripple" type="ColorRect" parent="CameraFollow/RippleLayer" unique_id=1455322373]
material = SubResource("ShaderMaterial_oscf3")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("11_oscf3")

[node name="DeathPlane" type="Area2D" parent="." unique_id=20074737]
position = Vector2(0, -143)

[node name="CollisionShape2D" type="CollisionShape2D" parent="DeathPlane" unique_id=917751410]
shape = SubResource("WorldBoundaryShape2D_6v23s")

[node name="MultiMaskedTileMap" type="Node2D" parent="." unique_id=2080479599]
script = ExtResource("1_ljsc8")

[node name="MaskedTileMapLayer0" type="TileMapLayer" parent="MultiMaskedTileMap" unique_id=1921039142]
tile_set = ExtResource("10_nyalh")
script = ExtResource("3_nendb")
metadata/_custom_type_script = "uid://cqfbx47wt6d28"

[node name="MaskedTileMapLayer1" type="TileMapLayer" parent="MultiMaskedTileMap" unique_id=1601078793]
tile_set = ExtResource("10_nyalh")
script = ExtResource("3_nendb")
mask_number = 1
metadata/_custom_type_script = "uid://cqfbx47wt6d28"

[node name="MaskedTileMapLayer2" type="TileMapLayer" parent="MultiMaskedTileMap" unique_id=1632574672]
tile_set = ExtResource("10_nyalh")
script = ExtResource("3_nendb")
mask_number = 2
metadata/_custom_type_script = "uid://cqfbx47wt6d28"

[node name="MaskedTileMapLayer3" type="TileMapLayer" parent="MultiMaskedTileMap" unique_id=1646331872]
tile_set = ExtResource("10_nyalh")
script = ExtResource("3_nendb")
mask_number = 3
metadata/_custom_type_script = "uid://cqfbx47wt6d28"

[node name="CanvasModulate" type="CanvasModulate" parent="." unique_id=492747460]
visible = false
color = Color(0.70796657, 0.7079665, 0.7079665, 1)

[connection signal="death" from="PlayerCharacter" to="CameraFollow/SpotlightLayer/DeathSpotlight" method="_on_player_character_death"]
[connection signal="player_reached_exit" from="ExitDoor" to="PlayerCharacter" method="_on_exit_door_player_reached_exit"]
[connection signal="player_reached_exit" from="ExitDoor" to="CameraFollow/SpotlightLayer/DeathSpotlight" method="_on_exit_door_player_reached_exit"]
[connection signal="body_entered" from="DeathPlane" to="PlayerCharacter" method="_on_death_plane_body_entered"]
